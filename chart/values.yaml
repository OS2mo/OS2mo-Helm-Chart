# SPDX-FileCopyrightText: Magenta ApS
#
# SPDX-License-Identifier: MPL-2.0
---
# Annotations to de applied to all resources
annotations:
  chart_repository: "https://git.magenta.dk/rammearkitektur/os2mo-helm-chart"

ingress:
  # Must be 'nginx' for basic-auth to work
  class: "nginx"
  # Enable HTTP basic auth with autogenerated credentials.
  # See NOTES.txt for details on credentials after deploying.
  basic_auth: false
  # Whitelist of ip-ranges that can access the application.
  whitelist: null
  # TLS hostname
  hostname: "os2mo.example.com"
  # Name of the TLS secret to use for ingress. If set TLS will be enabled.
  # Can be used to point to externally managed secrets if tls_cert key and cert below
  # are not set.
  tls_secret: null
  # If key and cert are set, a TLS secret with tls_secret name will be generated.
  tls_cert:
    key: null
    cert: null

os2mo:
  replicaCount: 1
  image:
    repository: magentaaps/os2mo
    tag: latest
    pullPolicy: Always
    pullSecret: null
  port: 80
  gunicorn:
    max_workers: 1
  init:
    enabled: false
    image:
      repository: magentaaps/os2mo-init
      tag: latest
      pullPolicy: Always
    config: {}
    log_level: INFO
  resources:
    requests:
      memory: "1024Mi"
      cpu: "500m"
    limits:
      memory: "1536Mi"
      cpu: "1000m"
  external_env_config_map_name: null
  environment: {}
  probes:
    enabled: true
    startupProbe:
      failureThreshold: 150
      periodSeconds: 2

lora:
  replicaCount: 1
  image:
    repository: magentaaps/lora
    tag: latest
    pullPolicy: Always
  gunicorn:
    max_workers: 1
  init:
    image:
      repository: magentaaps/postgres-os2mo
      tag: 12.7-11.7
      pullPolicy: Always
  resources:
    requests:
      memory: "512Mi"
      cpu: "100m"
    limits:
      memory: "1024Mi"
      cpu: "250m"
  probes:
    enabled: true
    startupProbe:
      failureThreshold: 150
      periodSeconds: 2

dipex:
  image:
    repository: magentaaps/dipex
    tag: latest
    pullPolicy: Always
  settings:
    mox.base: "http://mox-service:8080"
    mora.base: "http://mo-service:5000"
    crontab.RUN_IMPORTS_DUMMY: true
    crontab.SVC_USER: "USER@KOMMUNE.NET"
    crontab.SVC_KEYTAB: "/tmp/keytab-file"
    crontab.CRON_BACKUP: "/tmp/backup-dir"
    crontab.CRON_LOG_FILE: "/tmp/cron-log-file"
    crontab.CRON_LOG_JSON_SINK: "/tmp/log.json"
    crontab.BACKUP_SAVE_DAYS: "60"
    crontab.SNAPSHOT_LORA: "/tmp/db-snapshot.sql"
    crontab.OS2MO_COMPOSE_YML: "/tmp/to/os2mo/docker-compose.yml"
  secrets: {}
  resources:
    requests:
      memory: "1000Mi"
      cpu: "250m"
    limits:
      memory: "1500Mi"
      cpu: "1000m"

keycloak:
  image:
    repository: quay.io/keycloak/keycloak
    tag: 14.0.0
    pullPolicy: Always
  init:
    image:
      repository: magentaaps/postgres-keycloak-init
      tag: 12.7-11.7
      pullPolicy: Always
  builder:
    image:
      repository: magentaaps/os2mo-keycloak-realm-builder
      tag: latest
      pullPolicy: Always
    lora_realm_enabled: false
    lora_dipex_client_enabled: false
    dipex_client_secret: null
    environment: {}
  startupProbe:
    failureThreshold: 60
    periodSeconds: 5
  resources:
    requests:
      memory: "2048Mi"
      cpu: "1000m"
    limits:
      memory: "4096Mi"
      cpu: "2000m"

database:
  # Determine whether to deploy the database as a pod
  external: false
  # Hostname for the database
  host: mox-db-service
  user: postgres
  # Name of the secret to use for external database.
  # If not set, it will be generated with the below password.
  password_secret: null
  # Null means autogenerated password
  password: null
  username_suffix: ""
  sslmode: ""
  resources:
    requests:
      memory: "1024Mi"
      cpu: "100m"
    limits:
      memory: "2048Mi"
      cpu: "250m"

omada:
  enabled: false
  image:
    repository: magentaaps/os2mint-omada
    tag: latest
    pullPolicy: Always
  it_system_user_key: omada_ad_guid
  odata_url: "MUST BE OVERRIDDEN"
  host_header: null
  ntlm:
    enabled: false
  cronjob_schedule: "0 6 * * *"
  resources:
    requests:
      memory: "512Mi"
      cpu: "100m"
    limits:
      memory: "1024Mi"
      cpu: "250m"

initContainers:
  resources:
    requests:
      memory: "64Mi"
      cpu: "100m"
    limits:
      memory: "128Mi"
      cpu: "250m"

nameOverride: ""
fullnameOverride: ""

fixture: null
